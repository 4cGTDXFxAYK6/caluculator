<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>履歴付き電卓</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
/* ------------------------------
   基本スタイル
------------------------------ */
:root{
  --bg:#000;
  --panel:rgba(255,255,255,0.08);
  --btn-dark:#333;
  --btn-gray:#a5a5a5;
  --btn-accent:#ff9f0a;
  --border:rgba(255,255,255,0.25);
  --row-b:rgba(255,255,255,0.18);
}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  font-family:-apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
}

body{
  display:flex;
  justify-content:center;
  align-items:center;
}

.calculator{
  width:100%;
  max-width:600px;
  padding:16px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
}

/* ------------------------------
   履歴
------------------------------ */
.history{
  background:var(--panel);
  color:#fff;
  height:300px;
  padding:12px 8px;
  border-radius:14px;
  overflow:auto;
  font-size:21px;
  margin-bottom:14px;
}

.history-line{
  padding:6px;
  display:flex;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,0.18);
}

.text{
  flex:1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.delete-btn{
  color:var(--btn-accent);
  font-size:26px;
  cursor:pointer;
}

/* ------------------------------
   合計
------------------------------ */
.total-box{
  background:rgba(255,255,255,0.10);
  color:#fff;
  padding:12px 16px;
  border-radius:12px;
  font-size:26px;
  text-align:right;
  margin-bottom:10px;
}

/* ------------------------------
   ボタン
------------------------------ */
.keys{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
}

button{
  height:56px;
  border:1px solid var(--border);
  background:#333;
  color:#fff;
  font-size:24px;
  position:relative;
  overflow:hidden;
}

.gray{ background:var(--btn-gray); color:#000; }
.orange{ background:var(--btn-accent); }
.dark{ background:var(--btn-dark); }
.zero{ grid-column:span 2; text-align:left; padding-left:28px; }

/* 押下エフェクト */
.pressed{
  background:rgba(255,255,255,0.65);
  color:#000;
  transform:scale(0.85);
}

/* ------------------------------
   iPad 縦向き
------------------------------ */
@media (min-width:768px) and (orientation:portrait){
  .calculator{ max-width:760px; }
  button{ height:74px; font-size:30px; }
  .history{ font-size:26px; }
}

/* ------------------------------
   iPad 横向き
------------------------------ */
@media (min-width:1024px) and (orientation:landscape){
  .calculator{ max-width:900px; }
  button{ height:70px; font-size:28px; }
  .history{ font-size:24px; }
}
</style>
</head>
<body>

<div class="calculator">

  <div id="history" class="history"></div>

  <div id="totalBox" class="total-box">合計: 0</div>

  <div class="keys">
    <button class="gray" data-value="DEL">⌫</button>
    <button class="gray" data-value="AC">AC</button>
    <button class="gray" data-value="%">%</button>
    <button class="orange" data-value="/">÷</button>

    <button class="dark" data-value="7">7</button>
    <button class="dark" data-value="8">8</button>
    <button class="dark" data-value="9">9</button>
    <button class="orange" data-value="*">×</button>

    <button class="dark" data-value="4">4</button>
    <button class="dark" data-value="5">5</button>
    <button class="dark" data-value="6">6</button>
    <button class="orange" data-value="-">-</button>

    <button class="dark" data-value="1">1</button>
    <button class="dark" data-value="2">2</button>
    <button class="dark" data-value="3">3</button>
    <button class="orange" data-value="+">+</button>

    <button class="dark zero" data-value="0">0</button>
    <button class="dark" data-value=".">.</button>
    <button class="orange" data-value="=">=</button>
  </div>
</div>

<script>
/* ------------------------------
   計算ロジック＋履歴
------------------------------ */
let current = "";
let previous = "";
let operator = null;
let historyData = [];

const historyEl = document.getElementById("history");
const totalBox = document.getElementById("totalBox");

function updateDisplayLine() {
  // 今回は入力行を別に表示していないので、ここでは何もしない
}

function addHistoryLine(expr, result) {
  const item = { expr, result };
  historyData.push(item);
  renderHistory();
  updateTotal();
}

function renderHistory() {
  historyEl.innerHTML = "";
  historyData.forEach((item, index) => {
    const line = document.createElement("div");
    line.className = "history-line";

    const text = document.createElement("div");
    text.className = "text";
    text.textContent = item.expr + " = " + item.result;

    const del = document.createElement("div");
    del.className = "delete-btn";
    del.textContent = "×";
    del.dataset.index = index;

    line.appendChild(text);
    line.appendChild(del);
    historyEl.appendChild(line);
  });
}

function updateTotal() {
  const sum = historyData.reduce((acc, item) => acc + Number(item.result), 0);
  totalBox.textContent = "合計: " + sum;
}

function calculate(a, b, op) {
  const x = Number(a);
  const y = Number(b);
  if (op === "+") return x + y;
  if (op === "-") return x - y;
  if (op === "*") return x * y;
  if (op === "/") return y === 0 ? 0 : x / y;
  return y;
}

function handleInput(value) {
  if (!isNaN(value) || value === ".") {
    if (value === "." && current.includes(".")) return;
    current += value;
    updateDisplayLine();
    return;
  }

  if (value === "AC") {
    current = "";
    previous = "";
    operator = null;
    updateDisplayLine();
    return;
  }

  if (value === "DEL") {
    current = current.slice(0, -1);
    updateDisplayLine();
    return;
  }

  if (value === "%") {
    if (current !== "") {
      current = String(Number(current) / 100);
      updateDisplayLine();
    }
    return;
  }

  if (value === "=") {
    if (previous !== "" && current !== "" && operator) {
      const result = calculate(previous, current, operator);
      const expr = previous + " " + operator + " " + current;
      addHistoryLine(expr, result);
      current = String(result);
      previous = "";
      operator = null;
      updateDisplayLine();
    }
    return;
  }

  // 演算子
  if (["+", "-", "*", "/"].includes(value)) {
    if (current === "" && previous === "") return;
    if (previous !== "" && current !== "" && operator) {
      const result = calculate(previous, current, operator);
      previous = String(result);
      current = "";
      operator = value;
      updateDisplayLine();
    } else {
      previous = current || previous;
      current = "";
      operator = value;
      updateDisplayLine();
    }
  }
}

/* ------------------------------
   ボタンクリック＋押下エフェクト
------------------------------ */
document.querySelector(".keys").addEventListener("click", e => {
  const btn = e.target.closest("button");
  if (!btn) return;

  const val = btn.dataset.value;
  btn.classList.add("pressed");
  setTimeout(() => btn.classList.remove("pressed"), 120);

  handleInput(val);
});

/* 履歴削除 */
historyEl.addEventListener("click", e => {
  const del = e.target.closest(".delete-btn");
  if (!del) return;
  const idx = Number(del.dataset.index);
  historyData.splice(idx, 1);
  renderHistory();
  updateTotal();
});
</script>

</body>
</html>
